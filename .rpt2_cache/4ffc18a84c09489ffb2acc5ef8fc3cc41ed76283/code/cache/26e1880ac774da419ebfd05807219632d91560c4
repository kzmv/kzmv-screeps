{"code":"import { getSourceId } from 'helpers.game';\r\nvar _ = require('lodash');\r\nexport var creepHelpers = {\r\n    exitMove: function (creep) {\r\n        if (creep.pos.x * creep.pos.y === 0 || creep.pos.x === 49 || creep.pos.y === 49) {\r\n            if (creep.room.name == creep.memory.home) {\r\n                creep.moveTo(new RoomPosition(25, 25, creep.memory.home), { maxRooms: 1, visualizePathStyle: { stroke: '#ffaa00' } });\r\n            }\r\n            else {\r\n                creep.moveTo(new RoomPosition(25, 25, creep.memory.targetRoom), { maxRooms: 1, visualizePathStyle: { stroke: '#ffaa00' } });\r\n            }\r\n        }\r\n    },\r\n    isWorking: function (creep) {\r\n        if (creep.memory.working && _.sum(creep.carry) == 0) {\r\n            creep.memory.working = false;\r\n        }\r\n        else if (!creep.memory.working && _.sum(creep.carry) == creep.carryCapacity) {\r\n            creep.memory.working = true;\r\n        }\r\n    },\r\n    extractFromSource: function (creep) {\r\n        var creepers = _.filter(Game.creeps, function (c) { return creep.memory.id == c.memory.id; });\r\n        if (!creep.memory.sourceId) {\r\n            creep.memory.sourceId = getSourceId(creep);\r\n        }\r\n        var source = Game.getObjectById(creep.memory.sourceId);\r\n        if (source && creep.harvest(source) == ERR_NOT_IN_RANGE) {\r\n            creep.moveTo(source, { visualizePathStyle: { stroke: '#ffaa00' } });\r\n        }\r\n    },\r\n    extractFromContainer: function (creep) {\r\n        var creepers = _.filter(Game.creeps, function (c) { return creep.memory.role == c.memory.role; });\r\n        if (!creep.memory.containerId) {\r\n            var targets = creep.room.find(FIND_STRUCTURES, {\r\n                filter: function (s) { return (s.structureType == STRUCTURE_CONTAINER || s.structureType == STRUCTURE_STORAGE) && s.store[RESOURCE_ENERGY] > 0; }\r\n            });\r\n            if (targets.length > 0) {\r\n                targets = _.sortBy(targets, function (s) { return creep.pos.getRangeTo(s); });\r\n                creep.memory.containerId = targets[0].id;\r\n            }\r\n        }\r\n        var target = Game.getObjectById(creep.memory.containerId);\r\n        if (target) {\r\n            var op = creep.withdraw(target, RESOURCE_ENERGY);\r\n            if (op == ERR_NOT_IN_RANGE) {\r\n                creep.moveTo(target, { visualizePathStyle: { stroke: '#ffaa00' } });\r\n            }\r\n            else if (op == OK) {\r\n                creep.memory.containerId = undefined;\r\n            }\r\n        }\r\n    },\r\n    transferToContainer: function (creep) {\r\n        var targets = creep.room.find(FIND_STRUCTURES, {\r\n            filter: function (s) { return (s.structureType == STRUCTURE_CONTAINER || s.structureType == STRUCTURE_STORAGE) && s.store[RESOURCE_ENERGY] < s.storeCapacity; }\r\n        });\r\n        targets = _.sortBy(targets, function (s) { return creep.pos.getRangeTo(s); });\r\n        if (targets.length > 0) {\r\n            if (creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n                creep.moveTo(targets[0], { visualizePathStyle: { stroke: '#ffaa00' } });\r\n            }\r\n        }\r\n        else {\r\n            this.transferToSpawn(creep);\r\n        }\r\n    },\r\n    transferToSpawn: function (creep) {\r\n        var targets = creep.room.find(FIND_STRUCTURES, {\r\n            filter: function (s) { return (s.structureType == STRUCTURE_EXTENSION ||\r\n                s.structureType == STRUCTURE_SPAWN ||\r\n                s.structureType == STRUCTURE_TOWER) && s.energy < s.energyCapacity; }\r\n        });\r\n        if (targets.length > 0) {\r\n            if (creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n                creep.moveTo(targets[0], { visualizePathStyle: { stroke: '#ffaa00' } });\r\n            }\r\n        }\r\n    },\r\n    pickupResources: function (creep) {\r\n        var droppedResources = _.sortBy(creep.room.find(FIND_DROPPED_RESOURCES), function (r) { return creep.pos.getRangeTo(r); });\r\n        if (droppedResources.length > 0) {\r\n            if (creep.pickup(droppedResources[0]) == ERR_NOT_IN_RANGE) {\r\n                creep.moveTo(droppedResources[0], { visualizePathStyle: { stroke: '#ffaa00' } });\r\n            }\r\n        }\r\n    },\r\n    pickupToumbstones: function (creep) {\r\n        var tombstones = _.sortBy(creep.room.find(FIND_TOMBSTONES), function (t) { return creep.pos.getRangeTo(t); });\r\n        tombstones = tombstones.filter(function (t) { return _.sum(t.store) > 0; });\r\n        if (tombstones.length > 0) {\r\n            for (var resource in tombstones[0].store)\r\n                if (creep.withdraw(tombstones[0], resource) == ERR_NOT_IN_RANGE) {\r\n                    creep.moveTo(tombstones[0], { visualizePathStyle: { stroke: '#ffaa00' } });\r\n                }\r\n        }\r\n    }\r\n};\r\n//# sourceMappingURL=helpers.role.js.map","map":{"version":3,"file":"helpers.role.js","sourceRoot":"","sources":["src/helpers.role.ts"],"names":[],"mappings":"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"}}
