{"code":"/*\r\n * Module code goes here. Use 'module.exports' to export things:\r\n * module.exports.thing = 'a thing';\r\n *\r\n * You can import it from another modules like this:\r\n * var mod = require('civilian.factory');\r\n * mod.thing == 'a thing'; // true\r\n */\r\nimport { roles } from 'roles';\r\nvar _ = require('lodash');\r\nexport var factory = {\r\n    run: function (spawner) {\r\n        for (var name in Memory.creeps) {\r\n            if (!Game.creeps[name]) {\r\n                delete Memory.creeps[name];\r\n                console.log('Clearing non-existing creep memory:', name);\r\n            }\r\n        }\r\n        var prioritisedRoles = _.sortBy(roles, function (role) { return role.priority; });\r\n        prioritisedRoles = _.filter(prioritisedRoles, function (role) { return _.filter(Game.creeps, function (creep) { return creep.memory.id == role.id; }).length < role.count; });\r\n        var role = prioritisedRoles[0];\r\n        if (role) {\r\n            var newName = role.name + Game.time;\r\n            var dryRun = spawner.spawnCreep(role.template, newName, { dryRun: true });\r\n            if (dryRun === 0) {\r\n                console.log('Spawning new ' + role.type + ': ' + newName);\r\n                var memory = {\r\n                    role: role.type,\r\n                    sourceId: undefined,\r\n                    working: true,\r\n                    targetRoom: role.targetRoom,\r\n                    home: spawner.room.name,\r\n                    id: role.id,\r\n                    name: newName\r\n                };\r\n                console.log('Memory: ' + memory);\r\n                console.log('Template: ' + role.template);\r\n                spawner.spawnCreep(role.template, newName, { memory: memory });\r\n                console.log(\"Next in queue: \" + role.type);\r\n                console.log(\"Priority queue: \" + prioritisedRoles.map(function (r) { return r.name; }));\r\n            }\r\n        }\r\n        if (spawner.spawning) {\r\n            var spawningCreep = Game.creeps[spawner.spawning.name];\r\n            spawner.room.visual.text('Building: ' + spawningCreep.memory.id, spawner.pos.x + 1, spawner.pos.y, { align: 'left', opacity: 0.8 });\r\n        }\r\n    }\r\n};\r\n//# sourceMappingURL=factory.js.map","map":{"version":3,"file":"factory.js","sourceRoot":"","sources":["src/factory.ts"],"names":[],"mappings":"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"}}
