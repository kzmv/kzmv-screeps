{"code":"import * as tslib_1 from \"tslib\";\r\nvar _ = require('lodash');\r\nimport { roles } from 'roles';\r\nexport var getSourceAPs = function (source) {\r\n    var accessPoints = 0;\r\n    var room = source.room;\r\n    var pos = source.pos;\r\n    var structure = room.lookForAt(LOOK_STRUCTURES, pos.x + 1, pos.y)[0];\r\n    if (room.lookForAt(LOOK_TERRAIN, pos.x + 1, pos.y)[0] != \"wall\" && (structure && structure.structureType != STRUCTURE_WALL)) {\r\n        accessPoints = accessPoints + 1;\r\n    }\r\n    structure = room.lookForAt(LOOK_STRUCTURES, pos.x + 1, pos.y + 1)[0];\r\n    if (room.lookForAt(LOOK_TERRAIN, pos.x + 1, pos.y + 1)[0] != \"wall\" && (structure && structure.structureType != STRUCTURE_WALL)) {\r\n        accessPoints = accessPoints + 1;\r\n    }\r\n    structure = room.lookForAt(LOOK_STRUCTURES, pos.x + 1, pos.y - 1)[0];\r\n    if (room.lookForAt(LOOK_TERRAIN, pos.x + 1, pos.y - 1)[0] != \"wall\" && (structure && structure.structureType != STRUCTURE_WALL)) {\r\n        accessPoints = accessPoints + 1;\r\n    }\r\n    structure = room.lookForAt(LOOK_STRUCTURES, pos.x - 1, pos.y)[0];\r\n    if (room.lookForAt(LOOK_TERRAIN, pos.x - 1, pos.y)[0] != \"wall\" && (structure && structure.structureType != STRUCTURE_WALL)) {\r\n        accessPoints = accessPoints + 1;\r\n    }\r\n    structure = room.lookForAt(LOOK_STRUCTURES, pos.x - 1, pos.y + 1)[0];\r\n    if (room.lookForAt(LOOK_TERRAIN, pos.x - 1, pos.y + 1)[0] != \"wall\" && (structure && structure.structureType != STRUCTURE_WALL)) {\r\n        accessPoints = accessPoints + 1;\r\n    }\r\n    structure = room.lookForAt(LOOK_STRUCTURES, pos.x - 1, pos.y - 1)[0];\r\n    if (room.lookForAt(LOOK_TERRAIN, pos.x - 1, pos.y - 1)[0] != \"wall\" && (structure && structure.structureType != STRUCTURE_WALL)) {\r\n        accessPoints = accessPoints + 1;\r\n    }\r\n    structure = room.lookForAt(LOOK_STRUCTURES, pos.x, pos.y + 1)[0];\r\n    if (room.lookForAt(LOOK_TERRAIN, pos.x, pos.y + 1)[0] != \"wall\" && (structure && structure.structureType != STRUCTURE_WALL)) {\r\n        accessPoints = accessPoints + 1;\r\n    }\r\n    structure = room.lookForAt(LOOK_STRUCTURES, pos.x, pos.y - 1)[0];\r\n    if (room.lookForAt(LOOK_TERRAIN, pos.x, pos.y - 1)[0] != \"wall\" && (structure && structure.structureType != STRUCTURE_WALL)) {\r\n        accessPoints = accessPoints + 1;\r\n    }\r\n    return accessPoints;\r\n};\r\nexport var getSourceId = function (creep) {\r\n    var sourcesAccessPoints = _.sortBy(getSourcesAcessPoints(creep.room), 'ap');\r\n    var totalAps = 0;\r\n    for (var _i = 0, sourcesAccessPoints_1 = sourcesAccessPoints; _i < sourcesAccessPoints_1.length; _i++) {\r\n        var source = sourcesAccessPoints_1[_i];\r\n        totalAps += source.ap;\r\n    }\r\n    var creeps = _.filter(Game.creeps, function (c) { return c.memory.id == creep.id; });\r\n    sourcesAccessPoints = sourcesAccessPoints.map(function (s) {\r\n        return tslib_1.__assign({}, s, { creepCount: Math.round(_.find(roles, function (r) { return r.id == creep.memory.id; }).count / (totalAps / s.ap)) });\r\n    });\r\n    var _loop_1 = function (source) {\r\n        if (_.filter(Game.creeps, function (c) { return c.memory.id == creep.memory.id && c.memory.sourceId == source.id; }).length < source.creepCount) {\r\n            return { value: source.id };\r\n        }\r\n    };\r\n    for (var _a = 0, sourcesAccessPoints_2 = sourcesAccessPoints; _a < sourcesAccessPoints_2.length; _a++) {\r\n        var source = sourcesAccessPoints_2[_a];\r\n        var state_1 = _loop_1(source);\r\n        if (typeof state_1 === \"object\")\r\n            return state_1.value;\r\n    }\r\n    return sourcesAccessPoints[sourcesAccessPoints.length - 1].id;\r\n};\r\nexport var getSourcesAcessPoints = function (room) {\r\n    var sources = room.find(FIND_SOURCES);\r\n    var sourceArray = [];\r\n    for (var _i = 0, sources_1 = sources; _i < sources_1.length; _i++) {\r\n        var source = sources_1[_i];\r\n        sourceArray.push({ id: source.id, ap: getSourceAPs(source) });\r\n    }\r\n    return sourceArray;\r\n};\r\n//# sourceMappingURL=helpers.game.js.map","map":{"version":3,"file":"helpers.game.js","sourceRoot":"","sources":["src/helpers.game.ts"],"names":[],"mappings":"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"}}
